<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>GeNet | Pre-Process</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.png') }}">
    <!--bootstrap-->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">

    <!--Import Google Icon Font-->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/fonts/family=Material+Icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/materialize-stepper.css') }}">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/materialize.min.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <style>
        #result_div {
            visibility: hidden;
        }

        #progress_bar {
            visibility: hidden;
        }

        .volcano_plot > img {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            width: 100%;
        }
    </style>

</head>

    <style> 
        #loader { 
            border: 12px solid #26a69a66; 
            border-radius: 50%; 
            border-top: 12px solid #26a69a; 
            width: 70px; 
            height: 70px; 
            animation: spin 1s linear infinite; 
        } 
          
        @keyframes spin { 
            100% { 
                transform: rotate(360deg); 
            } 
        } 
          
        .center-load { 
            position: absolute; 
            top: -230px; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            margin: auto; 
        }

        .container-1 {
            position: relative;
            text-align: center;
        }

        .top-right {
            position: absolute;
            top: 8px;
            right: 5px;
        }

    </style> 

<style type="text/css">

        #tourtip{
           width: 290px !important; 
        }

        #tourControls{
            top: 80px !important;
        }

    .notification-container{
        position: fixed;
        left: 10px;
        width: 245px;
        max-width: calc(100% - 30px);
    }

    .notification{
        background-color: #fff;
        /*border-radius: 5px;
        box-shadow: 0 3px 6px rgb(0, 0, 0, 0.2), 0 3px 6px rgb(0, 0, 0, 0.3);*/
        color: #fff;
        font-size: 14px;
        padding: 8px 0px;
        line-height: 20px;
        /*margin-bottom: 15px;*/
        animation: grow 0.5s ease-in forwards;
    }
    @keyframes grow{
        from {
            opacity: 0;
            transform: scale(0.5);
        }
        to{
            opacity: 1;
            transform: scale(1);
        }
    }

    .notification.hide{
        animation: shrink 0.4s ease-out forwards;
    }
    @keyframes shrink{
        to{
            opacity: 0;
            transform: scale(0.6);
        }
    }

    .notification-info{
        background-color: #00000096;
    }

</style>

<body class="main-body" style="background-color: #f3f6f9;">

<!-- Dropdown Structure -->
{% include 'horizontal_nav_bar.html' %}

<div class="notification-container" id="notification-container">
    <div class="notification notification-info">
        <div class="row">
            <p style="text-align: center;font-size: 15px;margin-bottom: -10px;">Do you want a trip?</p>
        </div>
        <div class="row" style="margin-bottom: 7px;margin-top: -8px;">
            <div class="col-sm-6">
                <a style="float: right;" href="javascript:void(0);" class="btn btn-primary tour">YES</a>
            </div>
            <div class="col-sm-6">
                <a class="btn btn-primary tour_no">NO</a>
            </div>
        </div>
    </div>
</div>

<div class="main-div-step5">
    <div class="card-content">

        <ul data-method="GET" class="stepper linear">
            <li class="step active">
                <a href="{{ url_for('preprocess.index') }}">
                    <div class="step-title waves-effect waves-dark">Pre-processing</div>
                </a>
            </li>
            <li class="step">
                <a href="{{ url_for('fs.index') }}">
                    <div class="step-title waves-effect waves-dark">Feature selection</div>
                </a>
            </li>
            <li class="step">
                <a href="{{ url_for('analyze.index') }}">
                    <div class="step-title waves-effect waves-dark">Analysis</div>
                </a>
            </li>
            <li class="step">
                <a href="{{ url_for('validation.index') }}">
                    <div class="step-title waves-effect waves-dark">Validation</div>
                </a>
            </li>
        </ul>

    </div>

    <div id="mainDataInterface-id" class="container mainDataInterface">
        <form id="main-form-div-step5" method="post" action="/pre/step-6/" enctype="multipart/form-data">
            <div class="step-content">
                <div class="row">
                    <h3 id="h3-head-4" class="card__title" style="text-align: center;color: #26a69a;">STEP 5 : FEATURE REDUCTION</h3>
                </div>

                <div class="row">
                    <div id="img_results_div" class="col-sm-8">
                        <div class="container-1">
                            <div class="volcano_plot">
                                <img id="fold-p" src="data:image/png;base64,{{ volcano_hash }}" alt="volcano">
                            </div>
                            <div class="top-right">
                                <button type="button" style="margin-left: 10px;color: #26a69a;border: none; background-color: white;"
                                        class="use-download-fold" value="">
                                    <i class="fas fa-file-download fa-2x"></i>
                                </button>
                            </div>  
                        </div>                      
                    </div>

                    <div class="col-sm-4">
                        <div class="row md-form">
                            <label><b>Fold Range</b></label>
                            <div id="fold_range_div" class="dropdown">
                                <select class="form-control dropdown-menu-fold-range" id="fold-range" name="fold-range">
                                    {% for name in data_array[1] %}
                                        <option value="{{ name }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row md-form">
                            <label><b>P-value</b></label>
                            <div id="p_value_range_div"  class="dropdown">
                                <select class="form-control dropdown-menu-p-value" id="p-value" name="p-value">
                                    {% for name in data_array[0] %}
                                        <option value="{{ name }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row progress" id="progress_bar">
                            <div class="indeterminate"></div>
                        </div>

                        <div id="calculate_feature_div" class="row" style="margin-top: 30px;">
                            <button id="btn-calculate" type="button" class="btn btn-primary btn-lg btn-block"><p
                                    class="btn-page-2-p">CALCULATE</p></button>
                        </div>
                        <div class="row" id="result_div">
                            <div class="row" style="margin-top: 30px;">
                                <h5 id="h4-head-2" class="card__title" style="text-align: center;">SELECTED NUMBER OF
                                    GENES</h5>
                            </div>

                            <div class="row">
                                <h5 id="h4-head-2" class="card__title" style="text-align: center;"><b
                                        id="selected_features_count">2000</b></h5>
                            </div>
                        </div>


                    </div>
                </div>

                <div class="step-actions">
                    <button id="btn-submit-step-5" class="waves-effect waves-dark btn next-step step-5-click">CONTINUE</button>
                    <button class="waves-effect waves-dark btn-flat previous-step">BACK</button>
                </div>
            </div>
        </form>

    </div>
</div>

    <div class="loader-div" style="display: none;">
        <div id="loader" class="center-load"></div> 
        <h5 style="margin-top: 18%;text-align: center;color: #26a69a; margin-bottom: 200px;">PROCESSING</h5>        
    </div> 

{% include 'footer.html' %}

</body>
</html>

<script type="text/javascript" src="{{ url_for('static', filename='js/jquery/jquery.min.js') }}"></script>

<script type="text/javascript" src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'></script>

<!-- jQueryValidation Plugin -->
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery/jquery.validate.min.js') }}"></script>

<!-- Compiled and minified JavaScript -->
<script type="text/javascript" src="{{ url_for('static', filename='js/materialize/materialize.min.js') }}"></script>

<script type="text/javascript" src="{{ url_for('static', filename='js/main-site/main.js') }}"></script>

<script type="text/javascript" src="{{ url_for('static', filename='js/main.js') }}"></script>

<script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>

<script type="text/javascript" src="{{ url_for('static', filename='js/fontawesome-all.js') }}"></script>

<script>

    $('#btn-calculate').click(function () {
        var fold_range = $('#fold-range').find(":selected").text();
        var p_value = $('#p-value').find(":selected").text();
        document.getElementById("progress_bar").style.visibility = "visible";
        document.getElementById("btn-calculate").disabled = true;
        $.get("./fr/pf/", {pvalue: p_value, foldChange: fold_range}, function (data, status) {
            console.log(data);
            document.getElementById("result_div").style.visibility = "visible";
            document.getElementById("selected_features_count").innerHTML = data;
            document.getElementById("progress_bar").style.visibility = "hidden";
            document.getElementById("btn-calculate").disabled = false;
        });


    });

    $('#btn-submit-step-5').click(function () {
        $('.main-div-step5').hide(0);
        $('.loader-div').show(0);
        $('.main-body').click(false);
        $("#main-form-div-step5").submit();
    });  

    $(".use-download-fold").click(function () {
        var img = document.getElementById('fold-p');
        var url = img.src;

        var a = document.createElement("a");
        a.href = url;
        a.download = "fold-p-test.png";
        a.click();
    });     
</script>

<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.aSimpleTour.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.2/jquery.scrollTo.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<script>
    var tour = {
        data : [
            { element : '#img_results_div', tooltip : 'Volcano Plot :Fold change vs -log10 (p-value) !', text: 'Fold vs p-value plot', position: 'R' },
            { element : '.use-download-fold', tooltip : 'Download this graph !', text: 'Download image', position: 'T' },
            { element : '#fold_range_div', tooltip : 'Fold change is the diﬀerence between the means of the two groups of samples. You can select a value to filter the genes that have a greater fold value !', text: 'Fold Range', position: 'L' },
            { element : '#p_value_range_div', tooltip : 'The p-value is a measure of how likely you are to get this spot data if no real difference existed. Therefore, a small p-value indicates that there is a small chance of getting this data if no real difference existed and therefore you decide that the difference in group expression data is significant.  Usually, we select 0.05 as the cut off for p-values!', text: 'P-value', position: 'B' },
            { element : '#calculate_feature_div', tooltip : 'By selecting cut off values for p-values and the fold change, you can filter out deferentially expressed genes !', text: 'Filter out feature', position: 'T' }
        ],
        welcomeMessage: 'Lets Start Tour!',
        controlsPosition : 'TL',
        buttons: {
            next  : { text : 'Next &rarr;', class : 'btn btn-default'},
            prev  : { text : '&larr; Previous', class: 'btn btn-default' },
            start : { text : 'Start', class: 'btn btn-primary' },
            end   : { text : 'End', class: 'btn btn-primary' }
        },
        controlsCss: {
            background: 'rgba(187, 178, 48, 0.71)',
            color: '#1c1d21',
            width: '400px',
            'border-radius': 0
        }
    };

    $(document).ready(function(){
        $('.tour').on('click', function(){
            $.aSimpleTour(tour);
            $('.notification-container').hide(1000);
        });
        $('.tour_no').on('click', function(){
            $('.notification-container').hide(1000);
        });
    });
</script>

